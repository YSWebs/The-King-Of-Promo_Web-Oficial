<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Sitio Web</title>
    <style>
        .visit-counter {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.3s ease;
        }
        
        .visit-counter:hover {
            transform: translateY(-2px);
        }
        
        .counter-icon {
            font-size: 16px;
        }
        
        .counter-number {
            font-weight: bold;
            font-size: 15px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .visit-counter {
                bottom: 10px;
                right: 10px;
                padding: 8px 15px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <!-- Tu contenido aqu√≠ -->
    
    <div class="visit-counter">
        <span class="counter-icon">üëÅÔ∏è</span>
        <span>Visitas:</span>
        <span class="counter-number" id="visitas">0</span>
    </div>

    <script>
        // Configuraci√≥n
        const INFINITYFREE_URL = 'https://thekingofpromooficial.infinityfree.me/counter.php';
        
        // Inicializar contador
        document.addEventListener('DOMContentLoaded', function() {
            updateCounter();
        });
        
        async function updateCounter() {
            const counterElement = document.getElementById('visitas');
            if (!counterElement) return;
            
            try {
                // Verificar si ya contamos en esta sesi√≥n
                const sessionKey = 'visitCounted_' + window.location.hostname;
                const now = Date.now();
                const lastCountTime = sessionStorage.getItem(sessionKey);
                
                let url = INFINITYFREE_URL;
                
                // Si ya contamos en los √∫ltimos 30 minutos, solo leer
                if (lastCountTime && (now - parseInt(lastCountTime)) < 30 * 60 * 1000) {
                    url += '?mode=readonly';
                }
                
                // A√±adir timestamp para evitar cach√©
                url += (url.includes('?') ? '&' : '?') + '_=' + Date.now();
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('Error en la respuesta');
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Actualizar display
                    counterElement.textContent = data.total.toLocaleString();
                    
                    // Si fue un incremento, marcar sesi√≥n
                    if (data.mode === 'increment') {
                        sessionStorage.setItem(sessionKey, now.toString());
                    }
                    
                    // Respaldo en localStorage
                    localStorage.setItem('lastCounterValue', data.total);
                    localStorage.setItem('lastCounterUpdate', now);
                }
                
            } catch (error) {
                console.warn('Contador remoto no disponible, usando respaldo local');
                
                // Respaldo con localStorage
                let localCount = localStorage.getItem('localVisitCount') || 0;
                localCount = parseInt(localCount);
                
                if (!sessionStorage.getItem('visitCounted')) {
                    localCount++;
                    localStorage.setItem('localVisitCount', localCount);
                    sessionStorage.setItem('visitCounted', 'true');
                }
                
                counterElement.textContent = localCount.toLocaleString();
            }
        }
        
        // Opcional: Actualizar contador peri√≥dicamente (cada 5 minutos)
        setInterval(updateCounter, 5 * 60 * 1000);
    </script>
</body>
</html>